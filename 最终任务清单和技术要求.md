# Web版AI旅行规划师 - 最终任务清单和技术要求

## 已完成的工作

### 1. 前端修改
- ✅ 删除了冗余组件：头像上传、验证码、热门目的地推荐、旅行计划分享功能
- ✅ 调整了个人中心(ProfileView.vue)的布局和样式，使其更加美观和用户友好
- ✅ 移除了相关的冗余API调用方法

### 2. 后端规划调整
- ✅ 修改了后端todo list，删除了冗余接口和功能
- ✅ 确认语音识别服务只需前端实现，后端不需要实现相关接口

## 最终技术栈要求

### 1. 前端技术栈
- **框架**：Vue.js 3.x
- **状态管理**：Pinia
- **路由**：Vue Router
- **UI组件库**：Element Plus
- **HTTP客户端**：Axios
- **语音识别**：科大讯飞语音识别API（前端直接集成）
- **构建工具**：Vite

### 2. 后端技术栈
- **运行环境**：Node.js
- **Web框架**：Express.js
- **数据库**：Supabase (PostgreSQL)
- **认证服务**：Supabase Authentication
- **AI模型**：阿里云百炼平台 (qwen-plus模型)

## Supabase连接所需内容

### 1. 必要的环境变量
```
# Supabase连接信息
SUPABASE_URL=https://oqkrldqheguswolzbdnp.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xa3JsZHFoZWd1c3dvbHpiZG5wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI4MzAzMDIsImV4cCI6MjA3ODQwNjMwMn0.httc90OFpzrAJfaqP49kq-0M13u-tCDJPb8cWyfLP68

# 数据库连接字符串
DATABASE_URL=postgresql://postgres:mkUhP9LnctZTSgpY@db.oqkrldqheguswolzbdnp.supabase.co:5432/postgres

# 阿里云百炼API
ALIYUN_BAILIAN_API_KEY=sk-3ed8868ade0c476e8aeca2f041ddf32b
```

### 2. 数据库表结构
- **users表**：由Supabase Authentication自动创建和管理
  - id (uuid, PRIMARY KEY)
  - email (varchar, UNIQUE NOT NULL)
  - password_hash (varchar, NOT NULL)
  - created_at (timestamp)
  - updated_at (timestamp)

- **travel_plans表**：旅行计划基本信息
  - id (uuid, PRIMARY KEY)
  - user_id (uuid, REFERENCES users(id))
  - name (varchar, NOT NULL)
  - destination (varchar, NOT NULL)
  - start_date (date)
  - end_date (date)
  - budget (decimal)
  - created_at (timestamp)
  - updated_at (timestamp)

- **travel_nodes表**：旅行节点详细信息
  - id (uuid, PRIMARY KEY)
  - plan_id (uuid, REFERENCES travel_plans(id))
  - node_type (varchar, NOT NULL) - 枚举：餐饮、景点、住宿、交通
  - name (varchar, NOT NULL)
  - location (varchar)
  - date (date)
  - time (time)
  - duration (integer) - 预计花费时间（分钟）
  - budget (decimal, DEFAULT 0) - 预算费用
  - expense (decimal, DEFAULT 0) - 实际费用
  - description (text)
  - sequence_order (integer) - 节点顺序
  - created_at (timestamp)
  - updated_at (timestamp)

### 3. 安全配置
- 启用Row Level Security (RLS)保护用户数据
- 为travel_plans和travel_nodes表配置适当的RLS策略
- 确保用户只能访问和修改自己的数据

### 4. 索引和性能优化
- 为频繁查询的字段创建索引
- 考虑创建视图简化常用查询

## 后端API接口要求

### 1. 用户认证接口
- `/api/auth/register` - 用户注册
- `/api/auth/login` - 用户登录
- `/api/auth/me` - 获取当前用户信息
- `/api/auth/logout` - 用户登出
- `/api/auth/update` - 更新用户信息
- `/api/auth/password` - 修改密码
- `/api/auth/delete` - 注销账号

### 2. 旅行计划接口
- `/api/plans/generate` - AI生成旅行计划
- `/api/plans` - 获取用户的旅行计划列表
- `/api/plans/:id` - 获取旅行计划详情
- `/api/plans` - 创建新旅行计划
- `/api/plans/:id` - 更新旅行计划
- `/api/plans/:id` - 删除旅行计划
- `/api/plans/stats` - 获取用户旅行统计数据

### 3. 费用管理接口
- `/api/nodes/:id/expense` - 更新旅行节点的费用记录

### 4. AI服务接口
- 内部调用阿里云百炼API生成旅行计划
- 内部调用阿里云百炼API解析费用信息

## 注意事项
1. 所有API密钥必须通过环境变量管理，不得硬编码
2. 数据库操作应遵循事务管理，确保数据一致性
3. 前端已移除头像上传、验证码等功能，后端无需实现相关接口
4. 语音识别功能由前端直接与科大讯飞API集成，后端不需要实现相关代理服务
5. 数据库设计应参考《数据库设计文档》中的详细规范